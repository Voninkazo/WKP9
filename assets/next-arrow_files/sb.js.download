var splitbee=function(exports){"use strict";var __assign=function(){return(__assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function __awaiter(o,a,s,c){return new(s=s||Promise)(function(e,t){function n(e){try{i(c.next(e))}catch(e){t(e)}}function r(e){try{i(c.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((c=c.apply(o,a||[])).next())})}function __generator(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}var sbKey="sb_uid",setUserCookie=function(e,t){var n,r,i;void 0===t&&(t=!1);var o=null===(r=null===(n=window)||void 0===n?void 0:n.location)||void 0===r?void 0:r.hostname,a=t?null===(i=null===o||void 0===o?void 0:o.match(/\w*\.\w*$/gi))||void 0===i?void 0:i[0]:o,s=new Date;s.setTime(s.getTime()+15768e7);var c="expires="+s.toUTCString();document.cookie=sbKey+"="+e+";path=/;SameSite=Lax;"+c+(t?";domain="+a:"")},getUserCookie=function(){var e=document.cookie.split(/; */).map(function(e){var t=e.split("="),n=t[0],r=t.slice(1);return{key:n,val:decodeURIComponent(r.join("="))}}).find(function(e){return e.key===sbKey});return e?e.val:void 0},_a,_b,_c,ENDPOINT="https://hive.splitbee.io",cs=document.currentScript,isRedirect=function(e){return"redirect"===e.type},UID_KEY="splitbee_uid",sbp=null===(_c=null===(_b=null===(_a=cs)||void 0===_a?void 0:_a.attributes)||void 0===_b?void 0:_b.splitbeeid)||void 0===_c?void 0:_c.value,referrerSent=!1,getUID=function(){return localStorage.getItem(UID_KEY)||void 0},setUserId=function(e){localStorage.setItem("_userId",e)},request=function(e){var c=e.path,u=e.body,d=e.setReferrer;return __awaiter(void 0,void 0,Promise,function(){var t,n,r,i,o,a,s;return __generator(this,function(e){switch(e.label){case 0:t=getUserCookie(),n=localStorage.getItem("_userId"),t||(t=getUID())&&setUserCookie(t),r=0===document.referrer.indexOf(location.protocol+"//"+location.host)?void 0:document.referrer,e.label=1;case 1:return e.trys.push([1,4,,5]),[4,fetch(ENDPOINT+c,{method:"POST",credentials:"include",headers:__assign(__assign(__assign({"Content-Type":"application/json"},t&&{uid:t}),n&&{userId:n}),sbp&&{sbp:sbp}),body:JSON.stringify(__assign(__assign({},u),r&&!referrerSent&&d&&{referrer:r}))})];case 2:return i=e.sent(),r&&(referrerSent=!0),[4,i.json().catch(function(e){})];case 3:return o=e.sent(),(a=null===(s=i)||void 0===s?void 0:s.headers.get("uid"))&&setUserCookie(a),[2,{response:o||{},statusCode:i.status}];case 4:return e.sent(),[2,{response:void 0,statusCode:404}];case 5:return[2]}})})},genId=function(){return Math.random().toString(36).substring(7)},sbReqId="",newReqId=function(){return sbReqId=genId()},pause=!1,secondsActive=0,idleS=0,timer=setInterval(function(){pause||(secondsActive+=1,30<=(idleS+=1)&&(pause=!0))},1e3),resetIdle=function(){idleS=0},setInactive=function(){pause=!0},setActive=function(){pause=!1,idleS=0},resetTime=function(){secondsActive=0};window.addEventListener("blur",setInactive),window.addEventListener("focus",setActive),["mousemove","scroll"].forEach(function(e){return document.addEventListener(e,resetIdle)});var sendEnd=function(){var e={uid:getUID(),requestId:sbReqId,data:{duration:secondsActive}};navigator&&navigator.sendBeacon&&navigator.sendBeacon(ENDPOINT+"/end",JSON.stringify(e))},_a$1,_b$1;window.addEventListener("beforeunload",sendEnd);var removeTrailingSlash=function(e){return e.replace(/\/$/,"")},removeHidden=function(){var e=document.querySelector("#estyle");e&&e.remove()},cs$1=document.currentScript,isDefer=(null===(_a$1=cs$1)||void 0===_a$1?void 0:_a$1.defer)||(null===(_b$1=cs$1)||void 0===_b$1?void 0:_b$1.async),to,isAnchorElement=function(e){return"a"===e.tagName},addListener=function(n,r,i){n.addEventListener("click",function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return isAnchorElement(n)?(t.preventDefault(),[4,track(r,i)]):[3,2];case 1:return e.sent(),n&&(location.href=n.href),[3,3];case 2:track(r,i),e.label=3;case 3:return[2]}})})})},addEventTracking=function(e){e&&e.forEach(function(t){var n=setInterval(function(){var e=document.querySelectorAll(t.selector);0!==e.length&&(e.forEach(function(e){addListener(e,t.event)}),clearInterval(n))},1e3)})},applyChanges=function(changes){changes.forEach(function(r){document.querySelectorAll(r.selector).forEach(function(e){r.attributes.forEach(function(attr){"onclick"===attr.key?e.addEventListener("click",function(){eval(attr.value)}):e[attr.key]=attr.value})})})},domChanges=[],trackingEvents=[],afterLoaded=function(){applyChanges(domChanges),addEventTracking(trackingEvents)};document.addEventListener("DOMContentLoaded",afterLoaded);var initSplitbee=function(f){return __awaiter(void 0,void 0,void 0,function(){var t,n,r,i,o,a,s,c,u,d,l,v;return __generator(this,function(e){switch(e.label){case 0:if(/[?&]nr/.test(location.search)||/[?&]ct_builder/.test(location.search))return[2];isDefer||(document.head.insertAdjacentHTML("afterbegin",'<style id="estyle">body{opacity:0;overflow:hidden;}</style>'),to=setTimeout(removeHidden,500)),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,request({path:"/i",setReferrer:!0,body:__assign({origin:window.location.href,requestId:newReqId()},f&&{eid:f})})];case 2:if(t=e.sent(),n=t.response,r=t.statusCode,to&&clearTimeout(to),(null===(a=n)||void 0===a?void 0:a.actions)&&(trackingEvents=null===(s=n)||void 0===s?void 0:s.actions),"redirect"===(i=null===(c=n)||void 0===c?void 0:c.type)&&isRedirect(n)&&(null===(d=null===(u=n)||void 0===u?void 0:u.changes)||void 0===d?void 0:d.url)){if((o=window.origin+(null===(v=null===(l=n)||void 0===l?void 0:l.changes)||void 0===v?void 0:v.url))&&""!==o&&removeTrailingSlash(o)!==removeTrailingSlash(window.location.href)&&200===r)return window.location.replace(o),[2];removeHidden()}return removeHidden(),"changes"===i&&n&&!isRedirect(n)&&(domChanges=n.changes,applyChanges(n.changes),setInterval(function(){applyChanges(n.changes)},500),localStorage.setItem(window.location.href,JSON.stringify({changes:n.changes}))),[3,4];case 3:return e.sent(),removeHidden(),[3,4];case 4:return addEventTracking(trackingEvents),[2]}})})};if(!window.splitbeeLoaded){initSplitbee();var pushState=history.pushState;history.pushState=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];sendEnd(),pushState.apply(history,e),initSplitbee(),resetTime()},window.splitbeeLoaded=!0}var trackedElements=new WeakMap,autoTrack=function(){var i="data-splitbee-event";document.querySelectorAll("["+i+"]").forEach(function(n){var r={},e=n.getAttributeNames().filter(function(e){return e.includes(i+"-")});0<e.length?e.forEach(function(e){var t=n.getAttribute(e);t&&(r[e.replace(i+"-","")]=t)}):r=void 0,trackedElements.has(n)||(trackedElements.set(n,!0),addListener(n,n.getAttribute(i),r))})};setInterval(autoTrack,500);var track=function(e,t){return request({path:"/t",body:{event:e,data:t}})},user={set:function(e){var t=e.id,n=e.email,r=t||n;r&&setUserId(r),request({path:"/user",body:e})}},init=initSplitbee;return exports.init=init,exports.track=track,exports.user=user,exports}({});
